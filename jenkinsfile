pipeline {
    agent any

    stages {
        stage('Deploy to SSH host') {
            steps {
                script {
                    echo 'Known Hosts Content:'
                    
                    // Fixing Permissions and Ownership
                    sh "echo ubuntu ALL=(ALL) NOPASSWD: /bin/chown >> /etc/sudoers.d/jenkins-chown"
                    sh "sudo chmod 440 /etc/sudoers.d/jenkins-chown"
                    sh "sudo chown root:root /etc/sudoers.d/jenkins-chown"

                    sh "sudo chown ubuntu:ubuntu /home/ubuntu/.ssh/known_hosts"
                    sh "chmod 644 /home/ubuntu/.ssh/known_hosts"
                    sh "cat /home/ubuntu/.ssh/known_hosts"

                    // Use 'sudo' to run the chown command
                    sh "sudo mkdir -p /home/test"
                    sh "sudo chown ubuntu:ubuntu /home/test"
                    
                    // Create a test.txt file in /home
                    sh "echo 'Hello, this is a test file' | sudo tee /home/test/test.txt"
                }
            }
        }

        // Add more stages as needed
    }

    post {
        success {
            echo 'Pipeline succeeded! All stages completed successfully.'
        }
        failure {
            echo 'Pipeline failed! At least one stage failed.'
        }
    }
}
