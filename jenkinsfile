pipeline {
    agent any

    environment {
        SSH_USER = 'ubuntu'
        SSH_KEY = credentials('e06285f3-0d2d-434a-91a4-05aecbcbf5a7') // Replace with your actual credentials ID
        TARGET_SERVER_IP = '13.232.231.36'
        REMOTE_HOME_DIR = '/home/ubuntu'
        FILE_CONTENT = 'Hello, this is the content of the text file.'
        FILE_NAME = 'example.txt'
    }

    stages {
        stage('Create Text File on Ubuntu Server') {
            steps {
                script {
                    // Set up SSH key
                    sshagent(credentials: [SSH_KEY]) {
                        // Create a text file on the Ubuntu server
                        sh "echo '${FILE_CONTENT}' | ssh -i ${SSH_KEY} ${SSH_USER}@${TARGET_SERVER_IP} 'cat > ${REMOTE_HOME_DIR}/${FILE_NAME}'"
                    }
                }
            }
        }
    }

    post {
        always {
            // Clean up: Remove SSH key from agent
            sshagent(['']) // Passing an empty list of credentials to stop the agent
        }
    }
}
