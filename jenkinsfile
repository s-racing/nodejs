pipeline {
    agent any

    environment {
        NODEJS_HOME = tool name: 'NodeJS 14', type: 'jsInstaller'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Install Node.js and npm') {
            steps {
                script {
                    tool name: 'NodeJS 14', type: 'jsInstaller'
                    env.PATH = "${env.NODEJS_HOME}/bin:${env.PATH}"
                    sh 'npm install -g npm@8'
                }
            }
        }

        stage('Build') {
            steps {
                echo 'Building the application...'
                // Add your build steps here
            }
        }

        stage('Deploy to SSH host') {
            steps {
                script {
                    withCredentials([sshUserPrivateKey(credentialsId: '4eed8674-a85f-40c9-8130-06391e4239c1', keyFileVariable: 'SSH_KEY')]) {
                        sh 'echo $SSH_KEY > /tmp/private_key'
                        sh 'chmod 600 /tmp/private_key'
                        sh 'scp -r ./README.md ./jenkinsfile ./package.json ./src ubuntu@35.154.138.52:/home/ubuntu/'
                    }
                }
            }
        }
    }

    post {
        always {
            echo 'Cleaning up...'
            // Add cleanup steps if necessary
        }
    }
}
